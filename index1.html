<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather App</title>
  <link rel="icon" type="image/png" href="cloudy.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="weather-app">
    <h2>🌍 Weather App</h2>
    <input list="cities" type="text" id="cityInput" placeholder="Enter city name">
    <datalist id="cities">
      <option value="London">
      <option value="New York">
      <option value="Tokyo">
      <option value="Paris">
      <option value="Delhi">
    </datalist>
    <button onclick="getWeather()">Search</button>
    <button onclick="getLocationWeather()">📍 Current Location</button>
    <div id="loading" class="loading" style="display:none;">Loading...</div>
    <div class="result" id="result"></div>
    <button class="toggle-btn" onclick="toggleUnit()">Switch °C/°F</button>

    <div class="history">
      <h4>Recent Searches</h4>
      <div id="historyButtons"></div>
    </div>
  </div>

  <script>
    let isCelsius = true; 
    const apiKey = "9e69a70558953df064a22da9fd1b439d"; // replace with your OpenWeatherMap API key

    // --- Get weather by city ---
    async function getWeather(city) {
      if (!city) {
        city = document.getElementById("cityInput").value.trim();
      }
      if (!city) {
        document.getElementById("result").innerHTML = `<p style="color:red;">Please enter a city name.</p>`;
        return;
      }

      saveToHistory(city);

      const unit = isCelsius ? "metric" : "imperial";
      const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=${unit}`;

      fetchWeather(url);
    }

    // --- Get weather by location ---
    function getLocationWeather() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const unit = isCelsius ? "metric" : "imperial";
          const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=${unit}`;
          fetchWeather(url);
        }, () => {
          document.getElementById("result").innerHTML = `<p style="color:red;">Location access denied.</p>`;
        });
      } else {
        document.getElementById("result").innerHTML = `<p style="color:red;">Geolocation not supported.</p>`;
      }
    }

    // --- Fetch weather from API ---
    async function fetchWeather(url) {
      document.getElementById("loading").style.display = "block";
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("City not found or Invalid API key");
        const data = await response.json();

        const tempUnit = isCelsius ? "°C" : "°F";
        const sunrise = new Date(data.sys.sunrise * 1000).toLocaleTimeString();
        const sunset = new Date(data.sys.sunset * 1000).toLocaleTimeString();

        document.getElementById("result").innerHTML = `
          <h3>${data.name}, ${data.sys.country}</h3>
          <img class="icon" src="https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png" alt="icon">
          <p>🌡 Temp: ${data.main.temp} ${tempUnit}</p>
          <p>🤔 Feels Like: ${data.main.feels_like} ${tempUnit}</p>
          <p>☁ Weather: ${data.weather[0].description}</p>
          <p>💨 Wind: ${data.wind.speed} ${isCelsius ? "m/s" : "mph"}</p>
          <p>💧 Humidity: ${data.main.humidity}%</p>
          <p>📊 Pressure: ${data.main.pressure} hPa</p>
          <p>🌅 Sunrise: ${sunrise}</p>
          <p>🌇 Sunset: ${sunset}</p>
        `;

        changeBackground(data.weather[0].main);

      } catch (error) {
        document.getElementById("result").innerHTML = `<p style="color:red;">${error.message}</p>`;
      } finally {
        document.getElementById("loading").style.display = "none";
      }
    }

    // --- Change background based on condition ---
    function changeBackground(condition) {
      if (condition.includes("Cloud")) {
        document.body.style.background = "linear-gradient(135deg, #bdc3c7, #2c3e50)";
      } else if (condition.includes("Rain")) {
        document.body.style.background = "linear-gradient(135deg, #00c6fb, #005bea)";
      } else if (condition.includes("Clear")) {
        document.body.style.background = "linear-gradient(135deg, #f7971e, #ffd200)";
      } else if (condition.includes("Snow")) {
        document.body.style.background = "linear-gradient(135deg, #e6dada, #274046)";
      } else {
        document.body.style.background = "linear-gradient(135deg, #74ebd5, #ACB6E5)";
      }
    }

    // --- Switch between °C and °F ---
    function toggleUnit() {
      isCelsius = !isCelsius;
      const city = document.getElementById("cityInput").value;
      if (city) {
        getWeather(city);
      }
    }

    // --- Save search history ---
    function saveToHistory(city) {
      let history = JSON.parse(localStorage.getItem("weatherHistory")) || [];
      if (!history.includes(city)) {
        history.unshift(city);
        if (history.length > 5) history.pop();
        localStorage.setItem("weatherHistory", JSON.stringify(history));
      }
      displayHistory();
    }

    // --- Display search history ---
    function displayHistory() {
      const history = JSON.parse(localStorage.getItem("weatherHistory")) || [];
      const container = document.getElementById("historyButtons");
      container.innerHTML = "";
      history.forEach(city => {
        const btn = document.createElement("button");
        btn.innerText = city;
        btn.onclick = () => getWeather(city);
        container.appendChild(btn);
      });
    }

    // Load history on page load
    window.onload = displayHistory;
  </script>
</body>
</html>
